<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Discord Esports Theme</title>
  <style>
    body {
      font-family: "Orbitron", system-ui, sans-serif;
      display:flex;justify-content:center;align-items:center;
      min-height:100vh;margin:0;
      background:#0d0f1a;
      color:#e6eef8;
    }
    .card {
      background:#141828;
      border:2px solid #2d3248;
      border-radius:14px;
      width:420px;
      box-shadow:0 0 25px rgba(0, 255, 170, 0.25);
      padding:20px;
    }
    h2 {
      margin:0 0 10px;
      font-size:20px;
      text-transform:uppercase;
      color:#00ffaa;
      letter-spacing:1px;
      text-shadow:0 0 6px #00ffaa80;
    }
    button {
      background:linear-gradient(90deg,#5865f2,#3a48d9);
      border:0;padding:10px 16px;
      border-radius:8px;
      color:#fff;font-weight:700;
      cursor:pointer;transition:0.2s;
    }
    button:hover { filter:brightness(1.2); }
    .section {
      margin-top:15px;
      background:#1b1f2f;
      border:1px solid #2e334c;
      border-radius:10px;
      padding:10px;
    }
    .section h3 {
      margin:0 0 10px;
      font-size:15px;
      color:#00ffaa;
      border-bottom:1px solid #2d3248;
      padding-bottom:4px;
      text-transform:uppercase;
      text-shadow:0 0 4px #00ffaa70;
    }
    .member {
      display:flex;align-items:center;
      padding:6px 0;
      gap:10px;
    }
    .avatar {
      width:32px;height:32px;border-radius:50%;
      background:#2e334c;flex:0 0 32px;
      background-size:cover;background-position:center;
    }
    .name { font-weight:600; }
    .error {
      margin-top:10px;padding:8px;
      border-radius:8px;background:#3b1414;color:#ffb4b4;
    }
  </style>
</head>
<body>
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h2>Bot Support Server</h2>
      <button id="showBtn">Load Discord</button>
    </div>

    <div id="info" style="display:none">
      <p><strong>Server:</strong> <span id="serverName">—</span></p>
      <p><strong>Online:</strong> <span id="onlineCount">—</span></p>

      <div class="section">
        <h3>Online Members</h3>
        <div id="onlineList"></div>
      </div>

      <div class="section">
        <h3>Bots</h3>
        <div id="botList"></div>
      </div>

      <div id="error" class="error" style="display:none"></div>
    </div>
  </div>

<script>
const GUILD_ID = "1406976728831758456";

const showBtn = document.getElementById("showBtn");
const info = document.getElementById("info");
const serverNameEl = document.getElementById("serverName");
const onlineCountEl = document.getElementById("onlineCount");
const onlineList = document.getElementById("onlineList");
const botList = document.getElementById("botList");
const errorEl = document.getElementById("error");

showBtn.addEventListener("click", async () => {
  showBtn.disabled = true;
  showBtn.textContent = "Loading...";
  info.style.display = "block";
  await fetchAndShow();
  showBtn.textContent = "Reload";
  showBtn.disabled = false;
});

async function fetchAndShow() {
  const url = `https://discord.com/api/guilds/1406976728831758456/widget.json`;
  errorEl.style.display = "none";
  try {
    const res = await fetch(url,{cache:"no-store"});
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    serverNameEl.textContent = data.name || "—";
    onlineCountEl.textContent = data.presence_count ?? "—";

    onlineList.innerHTML = "";
    botList.innerHTML = "";

    if(Array.isArray(data.members)) {
      data.members.forEach(m=>{
        const div=document.createElement("div");
        div.className="member";
        const avatar=document.createElement("div");
        avatar.className="avatar";
        if(m.avatar_url){
          avatar.style.backgroundImage=`url(${m.avatar_url})`;
        }
        const text=document.createElement("div");
        text.innerHTML=`<div class="name">${escapeHtml(m.username||m.name||"Unknown")}</div>`;
        div.appendChild(avatar);
        div.appendChild(text);

        if(m.bot){
          botList.appendChild(div);
        }else if(m.status==="online"){
          onlineList.appendChild(div);
        }
      });
    }
  } catch(err){
    errorEl.style.display="block";
    errorEl.textContent="Could not load data. Ensure Server Widget is enabled.";
    console.warn(err);
  }
}

function escapeHtml(s){
  return String(s||"").replace(/[&<>"'`]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;","`":"&#96;"}[c]));
}
</script>
</body>
</html>
